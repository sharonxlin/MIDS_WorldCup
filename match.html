<!DOCTYPE html>
<meta charset="utf-8">
 <head>
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Lato">
  </head>
<style>
body { 
  color: #FFFFFF; 
  font: normal 10px "Lato"; 
  margin: 2em; 
}
#map {
  border:2px solid #000;
  width:960px;
  height:550px;
  background: #EEEEEE;
}

#slider-range {
  border:2px solid #000;
  width:960px;
  background: #EEEEEE;
}

#time {
  font: normal 20px "Lato"; 
}

.country {
  fill: #ccc;
  stroke: #fff;
  stroke-width: .5px;
  stroke-linejoin: round;
}

.hidden { 
  display: none; 
}

div.tooltip {
  color: #222; 
  background: #fff; 
  padding: .5em; 
  text-shadow: #f5f5f5 0 1px 0;
  border-radius: 2px; 
  box-shadow: 0px 0px 2px 0px #a6a6a6; 
  opacity: 0.9; 
  position: absolute;
}

.team1style {
  width: 300px;
  display: inline-block;
  text-align: right;
  padding-right: 10px;
}

.team2style {
  width: 300px;
  display: inline-block;
  text-align: left;
  padding-left: 10px;
}

.scorestyle {
  padding-right: 10px;
  padding-left: 10px;
}

#matches {
  width: 960px;
  height: 200px;
  font: normal 35px "Lato";
  text-align: center;
}

</style>
<link rel="stylesheet" type="text/css" href="map_js/jquery-ui-1.11.0.custom/jquery-ui.min.css">
<body>
<div id="drop">
  <select>
  <option value="Match01">6/12 Group Stage: BRA vs CRO</option>
  <option value="Match02">6/13 Group Stage: MEX vs CMR</option>
  <option value="Match03">6/13 Group Stage: ESP vs NED</option>
  <option value="Match04">6/13 Group Stage: CHI vs AUS</option>
  <option value="Match05">6/14 Group Stage: COL vs GRE</option>
  <option value="Match06">6/14 Group Stage: URU vs CRC</option>
  <option value="Match07">6/14 Group Stage: ENG vs ITA</option>
  <option value="Match08">6/15 Group Stage: CIV vs JPN</option>
  <option value="Match09">6/15 Group Stage: SUI vs ECU</option>
  <option value="Match10">6/15 Group Stage: FRA vs HON</option>
  <option value="Match11">6/15 Group Stage: ARG vs BIH</option>
  <option value="Match12">6/16 Group Stage: GER vs POR</option>
  <option value="Match13">6/16 Group Stage: IRN vs NGA</option>
  <option value="Match14">6/16 Group Stage: GHA vs USA</option>
  <option value="Match15">6/17 Group Stage: BEL vs ALG</option>
  <option value="Match16">6/17 Group Stage: BRA vs MEX</option>
  <option value="Match17">6/17 Group Stage: RUS vs KOR</option>
  <option value="Match18">6/18 Group Stage: AUS vs NED</option>
  <option value="Match19">6/18 Group Stage: ESP vs CHI</option>
  <option value="Match20">6/18 Group Stage: CMR vs CRO</option>
  <option value="Match21">6/19 Group Stage: COL vs CIV</option>
  <option value="Match22">6/19 Group Stage: URU vs ENG</option>
  <option value="Match23">6/19 Group Stage: JPN vs GRE</option>
  <option value="Match24">6/20 Group Stage: ITA vs CRC</option>
  <option value="Match25">6/20 Group Stage: SUI vs FRA</option>
  <option value="Match26">6/20 Group Stage: HON vs ECU</option>
  <option value="Match27">6/21 Group Stage: ARG vs IRN</option>
  <option value="Match28">6/21 Group Stage: GER vs GHA</option>
  <option value="Match29">6/21 Group Stage: NGA vs BIH</option>
  <option value="Match30">6/22 Group Stage: BEL vs RUS</option>
  <option value="Match31">6/22 Group Stage: KOR vs ALG</option>
  <option value="Match32">6/22 Group Stage: USA vs POR</option>
  <option value="Match33">6/23 Group Stage: AUS vs ESP</option>
  <option value="Match34">6/23 Group Stage: NED vs CHI</option>
  <option value="Match35">6/23 Group Stage: CMR vs BRA</option>
  <option value="Match36">6/23 Group Stage: CRO vs MEX</option>
  <option value="Match37">6/24 Group Stage: ITA vs URU</option>
  <option value="Match38">6/24 Group Stage: CRC vs ENG</option>
  <option value="Match39">6/24 Group Stage: JPN vs COL</option>
  <option value="Match40">6/24 Group Stage: GRE vs CIV</option>
  <option value="Match41">6/25 Group Stage: NGA vs ARG</option>
  <option value="Match42">6/25 Group Stage: BIH vs IRN</option>
  <option value="Match43">6/25 Group Stage: HON vs SUI</option>
  <option value="Match44">6/25 Group Stage: ECU vs FRA</option>
  <option value="Match45">6/26 Group Stage: USA vs GER</option>
  <option value="Match46">6/26 Group Stage: POR vs GHA</option>
  <option value="Match47">6/26 Group Stage: KOR vs BEL</option>
  <option value="Match48">6/26 Group Stage: ALG vs RUS</option>
  <option value="Match49">6/28 Round of 16: BRA vs CHI</option>
  <option value="Match50">6/28 Round of 16: COL vs URU</option>
  <option value="Match51">6/29 Round of 16: NED vs MEX</option>
  <option value="Match52">6/29 Round of 16: CRC vs GRE</option>
  <option value="Match53">6/30 Round of 16: FRA vs NGA</option>
  <option value="Match54">6/30 Round of 16: GER vs ALG</option>
  <option value="Match55">7/01 Round of 16: ARG vs SUI</option>
  <option value="Match56">7/01 Round of 16: BEL vs USA</option>
  <option value="Match57">7/04 Quarterfinals: FRA vs GER</option>
  <option value="Match58">7/04 Quarterfinals: BRA vs COL</option>
  <option value="Match59">7/05 Quarterfinals: ARG vs BEL</option>
  <option value="Match60">7/05 Quarterfinals: NED vs CRC</option>
  <option value="Match61">7/08 Semifinals: BRA vs GER</option>
  <option value="Match62">7/09 Semifinals: NED vs ARG</option>
  <option value="Match63">7/12 Third Place: BRA vs NED</option>
  <option value="Match64">7/13 Final: GER vs ARG</option>
  </select>
</div>
<br/><br/>
<div id="map"></div>
<br/><br/>
<div id="slider-range"></div>
<br/>
<div id="time"></div>


<script src="map_js/jquery-2.1.1.min.js"></script>
<script src="map_js/jquery-ui-1.11.0.custom/jquery-ui.min.js"></script>
<script type="text/javascript">
    $("#slider-range").slider({
        range: false,
        min: 0,
        max: 179,
        values: [0],
        slide: slideTime
    });

    function slideTime(event, ui){
        var val0 = $("#slider-range").slider("values", 0),
            minutes0 = parseInt(val0);
        startTime = getTime(minutes0);
        $("#time").text(startTime);
        $('#matches div').hide();
        $('#matches #match' + minutes0).show();
    }
    function getTime(minutes) {
        var time = null;
        minutes = minutes + "";
        return "Minute " + minutes;
        // + " " + hours + ":" + minutes + " " + time;
    }
    slideTime();
</script>

<script src="map_js/d3.js"></script>
<script src="map_js/queue.js"></script>
<script src="map_js/topojson.js"></script>


<script>
// The SVG container
var width  = 960,
    height = 550;

var color = d3.scale.category10();

var projection = d3.geo.mercator()
                .translate([480, 300])
                .scale(140);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);

var tooltip = d3.select("#map").append("div")
    .attr("class", "tooltip hidden");

queue()
    .defer(d3.json, "map_js/world-110m.json")
    .defer(d3.tsv, "map_js/world-country-names.tsv")
    .await(ready);

function ready(error, world, names) {
  if (typeof drawgraph === 'undefined'){
    setTimeout(function(){ready(error,world,names);}, 500);
  } else {
    draw_map(world, names);
    drawgraph();
  }
}

function draw_map(world, names) {

  var countries = topojson.object(world, world.objects.countries).geometries,
      neighbors = topojson.neighbors(world, countries),
      i = -1,
      n = countries.length;

  countries.forEach(function(d) { 
    d.name = names.filter(function(n) { return d.id == n.id; })[0].name; 
  });

var country = svg.selectAll(".country").data(countries);

  country
   .enter()
    .insert("path")
    .attr("class", "country")    
      .attr("title", function(d,i) { return d.name; })
      .attr("d", path)
      //.style("fill", function(d, i) { return color(d.color = d3.max(neighbors[i], function(n) { return countries[n].color; }) + 1 | 0); })
      .style("fill", "#FDB515");

    //Show/hide tooltip
    country
      .on("mousemove", function(d,i) {
        var mouse = d3.mouse(svg.node()).map( function(d) { return parseInt(d); } );

        tooltip
          .classed("hidden", false)
          .attr("style", "left:"+(mouse[0]+25)+"px;top:"+(mouse[1]+30)+"px")
          .html(d.name)
      })
      .on("mouseout",  function(d,i) {
        tooltip.classed("hidden", true)
      });

}
</script>

<script id="matches" src="map_js/Matches/Match01.js"></script>

<script>
function converttime(time){
  var d = new Date(time);
  var starttime = new Date(places[0].time)
  var converted_hour = d.getHours()-starttime.getHours();
  var converted_min = d.getMinutes();
  if (converted_hour<0){
    return (converted_hour+24)*60+converted_min;
  }
  else {return converted_hour*60+converted_min;}
}

function getpointsforminute(minute){
  var subset = [];
  for (i=0; i < places.length; i++){
    if (converttime(places[i].time) == minute){
      subset.push(places[i]);
    }
  }
  return subset;
}

function plotpoints (subset){
  svg.selectAll(".pin")
  .data(subset)
  .enter().append("circle", ".pin")
  .attr("r", function(d){return d.count*1.5+5;})
  .attr("transform", function(d) {
    return "translate(" + projection([
      d.location.longitude,
      d.location.latitude
    ]) + ")"
  })
  .style("fill", function(d){if (d.team===1) {return "#8C1515";} else {return "#003262";};})
  .style("fill-opacity", 0.70)
  // .style("stroke", "#003262")
  // .style("stroke-width", "0.5px")
  .style("stroke-opacity", 1);
}

function removepoints(){
  var circles = svg.selectAll('circle')[0];
  for (i = 0; i < circles.length; i ++){
    circles[i].remove();
  }
}

function drawgraph(){    
  removepoints();
  var slider_value = $("#slider-range").slider("values", 0);
  var minute = parseInt(slider_value);
  var subset = getpointsforminute(minute);
  plotpoints(subset);
}

function drawslide(slider_value){
  removepoints();
  var minute = parseInt(slider_value);
  var subset = getpointsforminute(minute);
  plotpoints(subset);
}
  
  $("#slider-range").on( "slidechange", function( event, ui ) {drawgraph();} );
  $("#slider-range").on( "slide", function( event, ui ) {drawslide(ui.value);} );
  $("#drop").on("change", function(event, ui){
    jQuery.getScript("map_js/Matches/" + event.target.value + ".js").done(function(){ drawgraph();});
  })


</script>
